# GovAI æ™ºèƒ½å…¬æ–‡ç³»ç»Ÿ â€” é¡¹ç›®å¯åŠ¨æŒ‡å—

## ä¸€ã€ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ (3000) â”‚â”€â”€â”€â”€â–¶â”‚ åç«¯ (8000)  â”‚â”€â”€â”€â”€â–¶â”‚  Dify AI     â”‚
â”‚  React+Vite  â”‚     â”‚ FastAPI      â”‚     â”‚ (SSH éš§é“)   â”‚
â”‚  nginx:alpineâ”‚     â”‚ python:3.12  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”€â”€â”¤  åŸºç¡€è®¾æ–½     â”œâ”€â”€â”€â”€â”€â”
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
      â”‚ PostgreSQL    â”‚          â”‚ Redis        â”‚
      â”‚ (AGE) :15432  â”‚          â”‚ :6379        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ PgAdmin      â”‚    â”‚ Converter    â”‚
      â”‚ :5050        â”‚    â”‚ (å¯é€‰) :8001 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## äºŒã€æœåŠ¡æ¸…å•

| æœåŠ¡      | å®¹å™¨å          | ç«¯å£  | è¯´æ˜                                 | å¿…éœ€    |
| --------- | --------------- | ----- | ------------------------------------ | ------- |
| postgres  | govai-postgres  | 15432 | PostgreSQL 16 + Apache AGE å›¾æ•°æ®åº“  | âœ…      |
| redis     | govai-redis     | 6379  | ç¼“å­˜ & ä¼šè¯å­˜å‚¨                      | âœ…      |
| backend   | govai-backend   | 8000  | FastAPI åç«¯ API                     | âœ…      |
| frontend  | govai-frontend  | 3000  | React å‰ç«¯ï¼ˆnginx åä»£ï¼‰             | âœ…      |
| pgadmin   | govai-pgadmin   | 5050  | æ•°æ®åº“ç®¡ç†ç•Œé¢                       | âš ï¸ å¯é€‰ |
| converter | govai-converter | 8001  | LibreOffice æ–‡æ¡£è½¬æ¢ï¼ˆPDF/æ–‡æœ¬æå–ï¼‰ | âš ï¸ å¯é€‰ |

## ä¸‰ã€ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 10/11 + WSL2ï¼ˆæ¨è Ubuntu 22.04ï¼‰
- **Docker**: Docker Desktop æˆ– WSL2 å†… Docker Engine
- **Node.js**: 18+ ï¼ˆæœ¬åœ°å‰ç«¯æ„å»ºï¼‰
- **pnpm**: 8+ï¼ˆå‰ç«¯åŒ…ç®¡ç†å™¨ï¼‰
- **ç½‘ç»œ**: éœ€è®¿é—® Dify æœåŠ¡å™¨ï¼ˆé€šè¿‡ SSH éš§é“ï¼‰

## å››ã€å¿«é€Ÿå¯åŠ¨ï¼ˆä¸€é”®å¯åŠ¨ 5 ä¸ªæ ¸å¿ƒæœåŠ¡ï¼‰

### 4.1 å‡†å¤‡ç¯å¢ƒå˜é‡

```bash
# é¡¹ç›®æ ¹ç›®å½•å·²æœ‰ .env æ–‡ä»¶ï¼Œæ£€æŸ¥å…³é”®é…ç½®
cat .env
```

å…³é”®å˜é‡è¯´æ˜ï¼š

| å˜é‡                        | è¯´æ˜             | ç¤ºä¾‹                         |
| --------------------------- | ---------------- | ---------------------------- |
| `DIFY_MOCK`                 | Dify æ¨¡å¼        | `false`=çœŸå®, `true`=Mock    |
| `DIFY_BASE_URL`             | Dify API åœ°å€    | `http://172.31.0.1:15001/v1` |
| `DIFY_APP_DOC_DRAFT_KEY`    | èµ·è‰ App Key     | `app-xxx...`                 |
| `DIFY_APP_DOC_CHECK_KEY`    | å®¡æŸ¥ App Key     | `app-xxx...`                 |
| `DIFY_APP_DOC_OPTIMIZE_KEY` | ä¼˜åŒ– App Key     | `app-xxx...`                 |
| `DIFY_APP_DOC_FORMAT_KEY`   | æ’ç‰ˆ App Key     | `app-xxx...`                 |
| `DIFY_APP_CHAT_KEY`         | çŸ¥è¯†é—®ç­” App Key | `app-xxx...`                 |

### 4.2 ä¸€é”®å¯åŠ¨

```bash
cd /mnt/d/apache-maven-3.9.1/GovAI

# å¯åŠ¨å…¨éƒ¨æ ¸å¿ƒæœåŠ¡ï¼ˆpostgres, redis, pgadmin, backend, frontendï¼‰
docker compose up -d
```

ç­‰å¾… postgres å’Œ redis å¥åº·æ£€æŸ¥é€šè¿‡ï¼ˆçº¦ 15 ç§’ï¼‰ï¼Œç„¶å backend å’Œ frontend è‡ªåŠ¨å¯åŠ¨ã€‚

### 4.3 éªŒè¯æœåŠ¡

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker compose ps

# éªŒè¯åç«¯
curl http://localhost:8000/health
# æœŸæœ›è¾“å‡º: {"status":"ok"}

# éªŒè¯å‰ç«¯
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/
# æœŸæœ›è¾“å‡º: 200
```

### 4.4 è®¿é—®åœ°å€

| æœåŠ¡        | URL                        |
| ----------- | -------------------------- |
| ğŸ–¥ï¸ å‰ç«¯ç•Œé¢ | http://localhost:3000      |
| ğŸ“¡ åç«¯ API | http://localhost:8000      |
| ğŸ“Š API æ–‡æ¡£ | http://localhost:8000/docs |
| ğŸ—ƒï¸ PgAdmin  | http://localhost:5050      |

> PgAdmin ç™»å½•: `admin@govai.dev` / `admin123`

## äº”ã€å‰ç«¯å¼€å‘ & çƒ­æ„å»º

### 5.1 æœ¬åœ°å¼€å‘ï¼ˆçƒ­é‡è½½ï¼‰

```bash
# å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡ï¼‰
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (http://localhost:5173)
pnpm dev
```

### 5.2 ç”Ÿäº§æ„å»º & éƒ¨ç½²åˆ°å®¹å™¨

```bash
# 1. æœ¬åœ°æ„å»º
npx vite build

# 2. å¤åˆ¶åˆ°å‰ç«¯å®¹å™¨
docker cp dist/. govai-frontend:/usr/share/nginx/html/

# 3. é‡å¯å‰ç«¯ï¼ˆå¯é€‰ï¼Œnginx é€šå¸¸è‡ªåŠ¨åŠ è½½æ–°æ–‡ä»¶ï¼‰
docker restart govai-frontend
```

## å…­ã€åç«¯å¼€å‘ & çƒ­æ›´æ–°

åç«¯å®¹å™¨é€šè¿‡ volume æŒ‚è½½äº† `./backend:/app`ï¼Œä»£ç ä¿®æ”¹ä¼šè‡ªåŠ¨åŒæ­¥ã€‚
uvicorn å¯ç”¨äº† `--reload`ï¼Œä¿®æ”¹ Python æ–‡ä»¶åè‡ªåŠ¨é‡å¯ã€‚

è‹¥éœ€æ‰‹åŠ¨æ›´æ–°ï¼š

```bash
# å¤åˆ¶æœ€æ–°ä»£ç åˆ°å®¹å™¨
docker cp backend/app/. govai-backend:/app/app/

# é‡å¯åç«¯
docker restart govai-backend

# æŸ¥çœ‹æ—¥å¿—
docker logs govai-backend --tail 30
```

## ä¸ƒã€Converter æœåŠ¡ï¼ˆå¯é€‰ï¼‰

converter æ˜¯åŸºäº LibreOffice çš„æ–‡æ¡£è½¬æ¢å¾®æœåŠ¡ï¼Œç”¨äº PDF è½¬æ¢å’Œæ–‡æœ¬æå–ã€‚
ç”±äºéœ€è¦æ‹‰å–é•œåƒå’Œå®‰è£… LibreOfficeï¼ˆçº¦ 500MBï¼‰ï¼Œåœ¨ç½‘ç»œå—é™ç¯å¢ƒä¸‹è®¾ä¸ºå¯é€‰ã€‚

### 7.1 å¯åŠ¨ converter

```bash
# éœ€è¦å¯è®¿é—® Docker Hub å’Œ Debian ä»“åº“çš„ç½‘ç»œç¯å¢ƒ
docker compose --profile full up -d converter
```

### 7.2 éªŒè¯

```bash
curl http://localhost:8001/health
```

> âš ï¸ å¦‚æœç½‘ç»œä¸é€šï¼ˆVPN/ä»£ç†ç¯å¢ƒï¼‰ï¼Œconverter æ— æ³•æ„å»ºã€‚
> æ­¤æ—¶ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ï¼ˆèµ·è‰/å®¡æŸ¥/ä¼˜åŒ–/æ’ç‰ˆï¼‰ä»æ­£å¸¸å·¥ä½œï¼Œä»… PDF è½¬æ¢åŠŸèƒ½ä¸å¯ç”¨ã€‚

## å…«ã€Dify AI æœåŠ¡å¯¹æ¥

### 8.1 SSH éš§é“ï¼ˆè¿æ¥å†…ç½‘ Difyï¼‰

```bash
# åœ¨ Windows ç»ˆç«¯å»ºç«‹ SSH éš§é“
ssh -L 15001:å†…ç½‘Difyåœ°å€:80 user@è·³æ¿æœº
```

### 8.2 TCP è½¬å‘ï¼ˆWSL â†’ Windows å®¿ä¸»æœºï¼‰

```bash
cd backend
python tcp_forward.py
```

å°† WSL å†… `172.31.0.1:15001` è½¬å‘åˆ° Windows å®¿ä¸»æœºçš„ SSH éš§é“ç«¯å£ã€‚

### 8.3 Dify Workflow DSL å¯¼å…¥

4 ä¸ª Workflow DSL æ–‡ä»¶ä½äº `dify/workflows_dsl/`ï¼š

| æ–‡ä»¶               | åŠŸèƒ½                     |
| ------------------ | ------------------------ |
| `æ™ºèƒ½å…¬æ–‡èµ·è‰.yml` | å…¬æ–‡èµ·è‰ï¼ˆChatflowï¼‰     |
| `æ™ºèƒ½å…¬æ–‡å®¡æŸ¥.yml` | å…¬æ–‡å®¡æŸ¥ï¼ˆChatflowï¼‰     |
| `æ™ºèƒ½å…¬æ–‡ä¼˜åŒ–.yml` | å…¬æ–‡ä¼˜åŒ–ï¼ˆChatflowï¼‰     |
| `æ™ºèƒ½æ–‡æ¡£æ’ç‰ˆ.yml` | æ–‡æ¡£æ’ç‰ˆï¼ˆå«å¯Œæ ¼å¼å±æ€§ï¼‰ |

åœ¨ Dify åå°å¯¼å…¥ DSL åï¼Œè¿˜éœ€åœ¨ LLM èŠ‚ç‚¹é…ç½®ã€Œç»“æ„åŒ–è¾“å‡ºã€ï¼š

| Schema æ–‡ä»¶            | å¯¹åº” Workflow |
| ---------------------- | ------------- |
| `schema_draft.json`    | æ™ºèƒ½å…¬æ–‡èµ·è‰  |
| `schema_check.json`    | æ™ºèƒ½å…¬æ–‡å®¡æŸ¥  |
| `schema_optimize.json` | æ™ºèƒ½å…¬æ–‡ä¼˜åŒ–  |
| `schema_format.json`   | æ™ºèƒ½æ–‡æ¡£æ’ç‰ˆ  |

å°†å¯¹åº” JSON Schema æ–‡ä»¶å†…å®¹ç²˜è´´åˆ° Dify LLM èŠ‚ç‚¹ â†’ ã€Œç»“æ„åŒ–è¾“å‡ºã€é¢æ¿ã€‚

## ä¹ã€å¸¸è§é—®é¢˜

### Q1: `docker compose up` æ—¶é•œåƒæ‹‰å–è¶…æ—¶

VPN/ä»£ç†ç¯å¢ƒä¸‹ Docker Hub ä¸å¯è¾¾ã€‚è§£å†³æ–¹æ¡ˆï¼š

```bash
# æ–¹æ¡ˆ A: ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå™¨
# ç¼–è¾‘ /etc/docker/daemon.json æ·»åŠ  registry-mirrors

# æ–¹æ¡ˆ B: ç¦»çº¿å¯¼å…¥é•œåƒ
docker save -o images.tar govai-backend govai-frontend apache/age redis:7-alpine
# åœ¨ç›®æ ‡æœºå™¨:
docker load -i images.tar
```

### Q2: `no such service: converte`

æ‹¼å†™é”™è¯¯ï¼Œæ­£ç¡®çš„æœåŠ¡åæ˜¯ **`converter`**ï¼ˆæ³¨æ„æœ«å°¾æœ‰ `r`ï¼‰ï¼š

```bash
# âŒ é”™è¯¯
docker compose up -d converte

# âœ… æ­£ç¡®
docker compose --profile full up -d converter
```

### Q3: åç«¯å¯åŠ¨æŠ¥é”™ `connection refused`

æ£€æŸ¥ postgres å’Œ redis æ˜¯å¦å·²å¯åŠ¨å¹¶é€šè¿‡å¥åº·æ£€æŸ¥ï¼š

```bash
docker compose ps
# ç¡®ä¿ postgres å’Œ redis çŠ¶æ€ä¸º healthy
```

### Q4: å‰ç«¯è®¿é—® API è¿”å› 502

nginx åä»£åˆ°åç«¯å¤±è´¥ã€‚æ£€æŸ¥ï¼š

```bash
# ç¡®è®¤åç«¯å®¹å™¨åœ¨è¿è¡Œ
docker logs govai-backend --tail 20

# ç¡®è®¤ç½‘ç»œè¿é€š
docker exec govai-frontend ping govai-backend
```

### Q5: Dify è°ƒç”¨è¿”å›è¶…æ—¶

æ£€æŸ¥ SSH éš§é“å’Œ TCP è½¬å‘æ˜¯å¦æ­£å¸¸ï¼š

```bash
# æµ‹è¯• Dify è¿é€šæ€§
curl http://172.31.0.1:15001/v1/parameters -H "Authorization: Bearer app-xxx"
```

## åã€åœæ­¢ & æ¸…ç†

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡ï¼ˆä¿ç•™æ•°æ®å·ï¼‰
docker compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆâš ï¸ ä¼šä¸¢å¤±æ•°æ®åº“æ•°æ®ï¼‰
docker compose down -v

# ä»…åœæ­¢æŸä¸ªæœåŠ¡
docker compose stop backend

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f backend
docker compose logs -f --tail 50
```

## åä¸€ã€ç«¯å£æ±‡æ€»

| ç«¯å£  | æœåŠ¡                      | åè®® |
| ----- | ------------------------- | ---- |
| 3000  | å‰ç«¯ (nginx)              | HTTP |
| 5050  | PgAdmin                   | HTTP |
| 5173  | å‰ç«¯å¼€å‘æœåŠ¡å™¨ (vite dev) | HTTP |
| 6379  | Redis                     | TCP  |
| 8000  | åç«¯ API                  | HTTP |
| 8001  | Converter (å¯é€‰)          | HTTP |
| 15432 | PostgreSQL                | TCP  |

---

_æœ€åæ›´æ–°: 2026-02-24_
